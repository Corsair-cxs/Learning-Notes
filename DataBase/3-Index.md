# Index

## 1. Search Key

用于在DB文件中查找记录的属性或属性集称为 **搜索码 (Search key)** 。如果文件上有多个索引，那么它就有多个search key。

## 2. 基本索引类型

- **顺序索引**：基于值的顺序排序
- **散列索引**：基于将值平均分布到若干散列桶中。一个值所属的散列桶是由hash function决定的

## 3. 顺序索引

### 3.1. 聚集索引和非聚集索引

**聚集索引 (Clustering Index)**

- 文件中记录按照某个key的指定的顺序存储，则该key对应的索引为聚集索引。
- 聚集索引又称为主索引。
- 聚集索引通常建立在主码上，但建立在别的key上也可以。
- 在key上有聚集索引的文件称为索引顺序文件。

**非聚集索引 (Nonclustering Index)**

- key指定的顺序与文件中记录的物理顺序不同。
- 非聚集索引又称为辅助索引。
- 必须为稠密索引，每个key都对应一个索引项。

### 3.2 稠密索引和稀疏索引

**索引项 (Index Entry)** 是由一个key和指向对应的一条或多条record的指针构成的。指向record的指针为 `page_id + offset`。

#### 3.2.1. 稠密索引 (Dense Index)

- 文件中每个key都有一个索引项
- 在稠密聚集索引当中，索引项包括key和指向对应第一条记录record的指针。其余record顺序地存储在第一条record之后。
- 在稠密非聚集索引中，索引项必须包括指向所有对应记录的指针列表。

#### 3.2.2. 稀疏索引 (Sparse Index)

- 只为key的部分值建立索引项
- 只有索引是聚集索引时才能使用稀疏索引，因为需要顺序遍历查找
- 索引项包括key和指向对应第一条记录record的指针。其余record顺序地存储在第一条record之后
- 为了寻找某key对应的record，先定位到小于等于该key的最大key Index，再顺序遍历找到该key对应的record

#### 3.2.3. 对比

通过稠密索引可以更快地定位到一条record，但是稀疏索引空间和维护开销小。

**为每个page建立一个索引项的稀疏索引是一个比较好的折中**：因为处理数据库查询的开销主要由把page从disk读到memory中的时间决定。一旦将page放入memory中，其顺序扫描的时间就可忽略。使用这样的稀疏索引可以定位到包含所要查询记录的块，这样，只要记录不在溢出块里，就能使访问次数最小且索引尽可能小。

### 3.3 外层索引

当索引过大而不能放在内存当中时，需要存储在disk中，当需要时，从disk中复制page到memory中。如果索引占有b个page，在索引文件上使用二分法搜索定位索引项也需要访问 `logb` 个磁盘块。

可以在原始的内层索引上构造稀疏的外层索引。因为索引是有序的，这使得外层索引可以是稀疏的。当寻找一个record时，首先通过二分法在外层索引上找到对应索引项，在从这个索引项中指针指向的索引块中找到记录对应的索引项。

假设外层索引全部存储在memory中，那么当使用多级索引时，一次查询只需要读取一个page（内部索引）。索引比使用二分法在内部索引上搜索要少很多disk IO次数。

### 3.4 多个属性上的索引

key不是单个属性，而是一个属性列表。key值按照字典序排序。

如一个key (course_id, semester, year)，这样的索引在查找特定学期/年注册了特定课程的学生是很有用的。

















