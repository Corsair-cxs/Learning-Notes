## 重载运算与类型转换

### 1. 运算符重载

#### 定义

当运算符作用于类类型的对象时，可以通过运算符重载重新定义该运算符的含义。

重载的运算符是具有特殊名字的函数，它们的名字由关键字 `operator` 和运算符号构成。重载的运算符也包含返回类型、参数列表以及函数体。

#### 参数数量

重载运算符函数的参数数量与运算符作用的运算对象数量一样多。

如果一个运算符函数是成员函数，则它的第一个运算对象绑定到隐式的this指针上。成员运算符函数的显式参数数量比运算对象数量少一个。

#### 什么样的运算符可以被重载

对于一个运算符函数来说，它或是类的成员，或者至少好友一个类类型的参数。

只能重载已有的运算符。

通常情况下，**不应该** 重载逗号、取地址、逻辑与和逻辑或运算符。

#### 直接调用重载的运算符函数

```c++
//一个非成员运算符函数的等价调用
data1 + data2;
operator+(data1, data2);
//一个成员运算符函数的等价调用
data1 += data2;
data1.operator+=(data2);
```

### 2. 输入和输出运算符

#### 重载输出运算符 <<

输出运算符的 **第一个形参** 是 **非常量ostream对象的引用** 。（非常量是因为向流写入内容会改变其状态；是引用是因为无法直接复制一个ostream对象）

**第二个形参** 是一个 **常量的引用** 。（是引用的原因是避免复制形参；常量是因为打印对象不会改变其内容）

```c++
ostream &operator<<(ostream &os, const Sales_data &item) {
    os << item.isbn();
    return os;
}
```

运算符返回刚使用的ostream的引用。

输出运算符负责打印对象的内容而非控制格式。

输入输出运算符必须是非成员函数，因为IO运算符常需要读写类的非公有数据成员，所以IO运算符一般被声明为友元。

#### 重载输入运算符 >>

输入运算符的 **第一个形参** 是运算符将要读取的流的引用。**第二个形参** 是将要读入到的（非常量）对象的引用。

该运算符返回给定输入流的引用。

```c++
istream &operator>>(istream &is, Sales_data &item) {
    double price;
    is >> item.isbn >> item.sold >> price;
    if (is)	//检查输入是否成功
        item.rev = item.sold * price;
    else
        item = Sales_data();	//输入失败，对象被赋予默认的状态
    return is;
}
```

输入运算符必须处理输入可能失败的情况，而输出运算符不需要。



 











